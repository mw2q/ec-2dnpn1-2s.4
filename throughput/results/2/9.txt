BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%blanched%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2736105138.45108
 ALGERIA                   |   1997 | 4674425027.38579
 ALGERIA                   |   1996 | 4686951013.93423
 ALGERIA                   |   1995 | 4655326931.41397
 ALGERIA                   |   1994 | 4628583277.16278
 ALGERIA                   |   1993 | 4633932377.20252
 ALGERIA                   |   1992 | 4668572143.21124
 ARGENTINA                 |   1998 | 2719893122.08967
 ARGENTINA                 |   1997 | 4658065912.56087
 ARGENTINA                 |   1996 | 4634140674.73726
 ARGENTINA                 |   1995 | 4634480250.75355
 ARGENTINA                 |   1994 | 4646664872.56737
 ARGENTINA                 |   1993 |  4629361378.6682
 ARGENTINA                 |   1992 | 4663828253.71328
 BRAZIL                    |   1998 | 2733113437.96322
 BRAZIL                    |   1997 | 4679504595.92325
 BRAZIL                    |   1996 | 4677814243.92224
 BRAZIL                    |   1995 | 4675980879.61774
 BRAZIL                    |   1994 | 4672330698.75941
 BRAZIL                    |   1993 | 4687371316.87932
 BRAZIL                    |   1992 | 4667254178.24261
 CANADA                    |   1998 | 2730167828.29324
 CANADA                    |   1997 |  4682334296.4336
 CANADA                    |   1996 | 4693768781.79639
 CANADA                    |   1995 | 4678773115.98361
 CANADA                    |   1994 | 4700048977.55673
 CANADA                    |   1993 | 4668044962.64143
 CANADA                    |   1992 | 4707363012.87246
 CHINA                     |   1998 | 2729067892.29721
 CHINA                     |   1997 | 4642703276.51105
 CHINA                     |   1996 | 4692603924.91383
 CHINA                     |   1995 | 4666279924.79378
 CHINA                     |   1994 | 4681276027.27829
 CHINA                     |   1993 | 4654869352.13383
 CHINA                     |   1992 | 4683622518.94101
 EGYPT                     |   1998 | 2724281284.03793
 EGYPT                     |   1997 | 4635475245.59448
 EGYPT                     |   1996 | 4663903410.61579
 EGYPT                     |   1995 | 4658606753.38099
 EGYPT                     |   1994 | 4638449418.19339
 EGYPT                     |   1993 | 4652524498.33835
 EGYPT                     |   1992 | 4672314971.09492
 ETHIOPIA                  |   1998 | 2743386869.39563
 ETHIOPIA                  |   1997 |  4693164262.9909
 ETHIOPIA                  |   1996 | 4709695948.68885
 ETHIOPIA                  |   1995 | 4692446936.09456
 ETHIOPIA                  |   1994 | 4700551630.75808
 ETHIOPIA                  |   1993 | 4696210852.14235
 ETHIOPIA                  |   1992 | 4705956432.61897
 FRANCE                    |   1998 | 2735814363.27015
 FRANCE                    |   1997 | 4697437955.85287
 FRANCE                    |   1996 | 4696833822.85212
 FRANCE                    |   1995 | 4694921999.40212
 FRANCE                    |   1994 | 4694855648.09299
 FRANCE                    |   1993 | 4682725545.05244
 FRANCE                    |   1992 | 4682573538.15683
 GERMANY                   |   1998 | 2748159695.44936
 GERMANY                   |   1997 | 4690834183.19073
 GERMANY                   |   1996 | 4707306908.94483
 GERMANY                   |   1995 | 4691314630.24504
 GERMANY                   |   1994 | 4685231269.37988
 GERMANY                   |   1993 | 4676197310.00817
 GERMANY                   |   1992 | 4701904218.99786
 INDIA                     |   1998 | 2765409585.68923
 INDIA                     |   1997 | 4682027759.48986
 INDIA                     |   1996 | 4709560887.67955
 INDIA                     |   1995 | 4684978989.50748
 INDIA                     |   1994 | 4680560231.07558
 INDIA                     |   1993 | 4683139117.46828
 INDIA                     |   1992 | 4696511467.48573
 INDONESIA                 |   1998 | 2723131897.01498
 INDONESIA                 |   1997 | 4668719805.98308
 INDONESIA                 |   1996 | 4664418909.01383
 INDONESIA                 |   1995 | 4628095583.90098
 INDONESIA                 |   1994 | 4666784698.82502
 INDONESIA                 |   1993 |  4642759880.0977
 INDONESIA                 |   1992 | 4687395523.63017
 IRAN                      |   1998 | 2717908891.52877
 IRAN                      |   1997 | 4614482534.27387
 IRAN                      |   1996 | 4621220646.48777
 IRAN                      |   1995 | 4630726965.17916
 IRAN                      |   1994 | 4610327742.72149
 IRAN                      |   1993 | 4640991177.72912
 IRAN                      |   1992 | 4636128446.43341
 IRAQ                      |   1998 | 2719579738.25779
 IRAQ                      |   1997 | 4657323372.95767
 IRAQ                      |   1996 |   4676258680.872
 IRAQ                      |   1995 | 4651428372.97441
 IRAQ                      |   1994 | 4639266481.26709
 IRAQ                      |   1993 | 4665356673.90304
 IRAQ                      |   1992 | 4686180852.16588
 JAPAN                     |   1998 | 2711819159.60335
 JAPAN                     |   1997 | 4647445441.51232
 JAPAN                     |   1996 | 4683499056.50125
 JAPAN                     |   1995 | 4643639359.64213
 JAPAN                     |   1994 | 4668303433.35682
 JAPAN                     |   1993 |  4671881775.3163
 JAPAN                     |   1992 | 4657520333.74248
 JORDAN                    |   1998 | 2735427161.82782
 JORDAN                    |   1997 | 4658882134.63444
 JORDAN                    |   1996 | 4657475245.73077
 JORDAN                    |   1995 | 4648612303.19857
 JORDAN                    |   1994 | 4642535438.10807
 JORDAN                    |   1993 | 4632364669.67361
 JORDAN                    |   1992 | 4681658241.52445
 KENYA                     |   1998 | 2719020528.72102
 KENYA                     |   1997 | 4597909694.78325
 KENYA                     |   1996 | 4630679718.82994
 KENYA                     |   1995 | 4621256215.06315
 KENYA                     |   1994 | 4596438856.97416
 KENYA                     |   1993 | 4637196168.53815
 KENYA                     |   1992 | 4616609441.95178
 MOROCCO                   |   1998 |  2741653263.4549
 MOROCCO                   |   1997 | 4669931113.12699
 MOROCCO                   |   1996 | 4664739233.82644
 MOROCCO                   |   1995 | 4668862491.48249
 MOROCCO                   |   1994 | 4657910474.88464
 MOROCCO                   |   1993 | 4685243280.89101
 MOROCCO                   |   1992 | 4712659864.95036
 MOZAMBIQUE                |   1998 | 2739886798.87758
 MOZAMBIQUE                |   1997 | 4637459368.28284
 MOZAMBIQUE                |   1996 | 4683262423.34779
 MOZAMBIQUE                |   1995 | 4659079305.64581
 MOZAMBIQUE                |   1994 |   4633998029.413
 MOZAMBIQUE                |   1993 | 4650344521.09272
 MOZAMBIQUE                |   1992 | 4654857213.50808
 PERU                      |   1998 |  2719484577.4592
 PERU                      |   1997 | 4620232767.50731
 PERU                      |   1996 |  4660734293.3303
 PERU                      |   1995 | 4655588601.64944
 PERU                      |   1994 | 4656106489.82474
 PERU                      |   1993 | 4615357820.83694
 PERU                      |   1992 | 4635244106.05801
 ROMANIA                   |   1998 | 2731601109.43619
 ROMANIA                   |   1997 | 4659071591.19609
 ROMANIA                   |   1996 | 4703817215.67511
 ROMANIA                   |   1995 | 4653038910.72878
 ROMANIA                   |   1994 | 4687294242.75419
 ROMANIA                   |   1993 |  4689108250.9132
 ROMANIA                   |   1992 | 4692918111.57963
 RUSSIA                    |   1998 | 2740218525.00502
 RUSSIA                    |   1997 | 4684552818.62641
 RUSSIA                    |   1996 |  4681433846.6844
 RUSSIA                    |   1995 | 4680735635.45245
 RUSSIA                    |   1994 | 4671202744.33577
 RUSSIA                    |   1993 | 4685208598.69416
 RUSSIA                    |   1992 | 4700524430.09846
 SAUDI ARABIA              |   1998 |  2718429181.1544
 SAUDI ARABIA              |   1997 | 4651002519.68554
 SAUDI ARABIA              |   1996 | 4660114157.85531
 SAUDI ARABIA              |   1995 | 4634268094.19348
 SAUDI ARABIA              |   1994 | 4668670883.94452
 SAUDI ARABIA              |   1993 | 4631864468.45042
 SAUDI ARABIA              |   1992 |  4669855790.3677
 UNITED KINGDOM            |   1998 | 2764522276.46958
 UNITED KINGDOM            |   1997 | 4695478402.70569
 UNITED KINGDOM            |   1996 | 4709159920.92993
 UNITED KINGDOM            |   1995 | 4705239376.09057
 UNITED KINGDOM            |   1994 | 4684620129.45237
 UNITED KINGDOM            |   1993 |  4665157143.4394
 UNITED KINGDOM            |   1992 | 4705957856.57204
 UNITED STATES             |   1998 | 2728930575.35753
 UNITED STATES             |   1997 | 4683501521.86478
 UNITED STATES             |   1996 | 4708363509.04226
 UNITED STATES             |   1995 | 4670938822.96848
 UNITED STATES             |   1994 | 4674725829.17104
 UNITED STATES             |   1993 | 4677804865.12139
 UNITED STATES             |   1992 | 4683172845.75378
 VIETNAM                   |   1998 | 2732781062.49814
 VIETNAM                   |   1997 | 4655500124.37222
 VIETNAM                   |   1996 |  4668177864.5848
 VIETNAM                   |   1995 | 4673665785.95187
 VIETNAM                   |   1994 | 4671750152.73384
 VIETNAM                   |   1993 |  4663607463.7854
 VIETNAM                   |   1992 | 4685714759.05914
(175 rows)

COMMIT;
COMMIT
